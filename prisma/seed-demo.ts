// Seed script za demo naloge - 5 razliƒçitih profila
import { PrismaClient } from "@prisma/client";
import bcrypt from "bcryptjs";

const prisma = new PrismaClient();

const DEMO_ACCOUNTS = [
  {
    name: "Marko Markoviƒá",
    email: "marko@demo.rs",
    password: "marko123",
    phone: "0641234567",
    role: "STUDENT" as const,
    school: 'O≈† "Vuk Karad≈æiƒá"',
    grade: 5,
    class: "A",
    description: "Odliƒçan uƒçenik, voli matematiku i fiziku",
  },
  {
    name: "Ana Petroviƒá",
    email: "ana@demo.rs",
    password: "ana123",
    phone: "0642345678",
    role: "STUDENT" as const,
    school: 'O≈† "Dositej Obradoviƒá"',
    grade: 6,
    class: "B",
    description: "Talentovana za jezike i umetnost",
  },
  {
    name: "Stefan Nikoliƒá",
    email: "stefan@demo.rs",
    password: "stefan123",
    phone: "0643456789",
    role: "STUDENT" as const,
    school: 'O≈† "Jovan Jovanoviƒá Zmaj"',
    grade: 7,
    class: "C",
    description: "Sportista i lider u odeljenju",
  },
  {
    name: "Milica Stankoviƒá",
    email: "milica@demo.rs",
    password: "milica123",
    phone: "0644567890",
    role: "STUDENT" as const,
    school: 'O≈† "Petar Petroviƒá Njego≈°"',
    grade: 4,
    class: "A",
    description: "Kreativna, voli da crta i pi≈°e priƒçe",
  },
  {
    name: "Luka Pavloviƒá",
    email: "luka@demo.rs",
    password: "luka123",
    phone: "0645678901",
    role: "STUDENT" as const,
    school: 'O≈† "Branko Radiƒçeviƒá"',
    grade: 8,
    class: "D",
    description: "IT entuzijasta, voli programiranje",
  },
];

async function main() {
  console.log("üå± Zapoƒçinjem seed za demo naloge...\n");

  // Prvo obri≈°i sve postojeƒáe podatke
  await prisma.link.deleteMany({});
  await prisma.homework.deleteMany({});
  await prisma.scheduleEntry.deleteMany({});
  await prisma.studentSubject.deleteMany({});
  await prisma.subject.deleteMany({});
  await prisma.student.deleteMany({});
  await prisma.guardian.deleteMany({});
  await prisma.user.deleteMany({});
  console.log("üóëÔ∏è Stari podaci obrisani\n");

  // Kreiraj demo naloge
  console.log("üë®‚Äçüéì Kreiram demo naloge:\n");

  for (const account of DEMO_ACCOUNTS) {
    const hashedPassword = await bcrypt.hash(account.password, 10);

    const created = await prisma.user.create({
      data: {
        email: account.email,
        phone: account.phone,
        password: hashedPassword,
        role: account.role,
        student: {
          create: {
            name: account.name,
            school: account.school,
            grade: account.grade,
            class: account.class,
          },
        },
      },
      select: {
        student: {
          select: { id: true },
        },
      },
    });

    if (created.student) {
      await prisma.gamification.create({
        data: {
          studentId: created.student.id,
        },
      });
    }

    console.log(`‚úÖ ${account.name}`);
    console.log(`   üìß Email: ${account.email}`);
    console.log(`   üîë Lozinka: ${account.password}`);
    console.log(`   üè´ ${account.school} - ${account.grade}/${account.class}`);
    console.log(`   üí° ${account.description}\n`);
  }

  // Kreiraj predmete za sve uƒçenike
  console.log("üìö Kreiram predmete...\n");

  const subjects = await Promise.all([
    prisma.subject.create({
      data: { name: "Matematika", color: "#3b82f6", icon: "üìê" },
    }),
    prisma.subject.create({
      data: { name: "Srpski jezik", color: "#ef4444", icon: "üìñ" },
    }),
    prisma.subject.create({
      data: { name: "Engleski jezik", color: "#10b981", icon: "üá¨üáß" },
    }),
    prisma.subject.create({
      data: { name: "Istorija", color: "#f59e0b", icon: "üèõÔ∏è" },
    }),
    prisma.subject.create({
      data: { name: "Geografija", color: "#14b8a6", icon: "üåç" },
    }),
    prisma.subject.create({
      data: { name: "Biologija", color: "#22c55e", icon: "üß¨" },
    }),
    prisma.subject.create({
      data: { name: "Hemija", color: "#8b5cf6", icon: "‚öóÔ∏è" },
    }),
    prisma.subject.create({
      data: { name: "Fizika", color: "#6366f1", icon: "‚öõÔ∏è" },
    }),
    prisma.subject.create({
      data: { name: "Likovno", color: "#ec4899", icon: "üé®" },
    }),
    prisma.subject.create({
      data: { name: "Muziƒçko", color: "#f97316", icon: "üéµ" },
    }),
    prisma.subject.create({
      data: { name: "Fiziƒçko", color: "#06b6d4", icon: "‚öΩ" },
    }),
    prisma.subject.create({
      data: { name: "Informatika", color: "#0ea5e9", icon: "üíª" },
    }),
  ]);

  console.log(`‚úÖ Kreirano ${subjects.length} predmeta\n`);

  const getSubject = (name: string) => {
    const subject = subjects.find((s) => s.name === name);
    if (!subject) {
      throw new Error(`Subject "${name}" nije pronaƒëen tokom seed-a.`);
    }
    return subject;
  };

  // Dodaj po nekoliko domaƒáih zadataka za prvog uƒçenika (Marko)
  const marko = await prisma.user.findUnique({
    where: { email: "marko@demo.rs" },
    include: { student: true },
  });

  if (marko?.student) {
    console.log("üìù Dodajem domaƒáe zadatke za Marka...\n");

    const matematika = getSubject("Matematika");
    const srpski = getSubject("Srpski jezik");
    const engleski = getSubject("Engleski jezik");

    await prisma.homework.create({
      data: {
        title: "Kvadratne jednaƒçine - ve≈æbe",
        description: "Re≈°iti zadatke 1-10 iz ud≈æbenika strana 45",
        dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000), // Za 2 dana
        priority: "IMPORTANT",
        status: "ASSIGNED",
        studentId: marko.student.id,
        subjectId: matematika.id,
      },
    });

    await prisma.homework.create({
      data: {
        title: "Esej o proleƒáu",
        description: "Napisati esej od 200 reƒçi o proleƒáu i prirodi",
        dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000), // Za 5 dana
        priority: "NORMAL",
        status: "IN_PROGRESS",
        studentId: marko.student.id,
        subjectId: srpski.id,
      },
    });

    await prisma.homework.create({
      data: {
        title: "Past Simple Tense",
        description: "Ve≈æbati pro≈°lo vreme - workbook str. 23-25",
        dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000), // Sutra
        priority: "URGENT",
        status: "ASSIGNED",
        studentId: marko.student.id,
        subjectId: engleski.id,
      },
    });

    console.log("‚úÖ Dodato 3 domaƒáa zadatka\n");
  }

  // Dodaj raspored za Marka
  if (marko?.student) {
    console.log("üìÖ Kreiram raspored ƒçasova za Marka...\n");

  const matematika = getSubject("Matematika");
  const srpski = getSubject("Srpski jezik");
  const engleski = getSubject("Engleski jezik");
  const fizika = getSubject("Fizika");
  const istorija = getSubject("Istorija");
  const fizicko = getSubject("Fiziƒçko");

    await Promise.all([
      // Ponedeljak
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: matematika.id,
          dayOfWeek: "MONDAY",
          startTime: "08:00",
          endTime: "08:45",
          room: "101",
          isAWeek: true,
          isBWeek: true,
        },
      }),
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: srpski.id,
          dayOfWeek: "MONDAY",
          startTime: "09:00",
          endTime: "09:45",
          room: "205",
          isAWeek: true,
          isBWeek: true,
        },
      }),

      // Utorak
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: engleski.id,
          dayOfWeek: "TUESDAY",
          startTime: "08:00",
          endTime: "08:45",
          room: "302",
          isAWeek: true,
          isBWeek: true,
        },
      }),
      fizika &&
        prisma.scheduleEntry.create({
          data: {
            studentId: marko.student.id,
            subjectId: fizika.id,
            dayOfWeek: "TUESDAY",
            startTime: "09:00",
            endTime: "09:45",
            room: "Lab 1",
            isAWeek: true,
            isBWeek: true,
          },
        }),

      // Sreda
      istorija &&
        prisma.scheduleEntry.create({
          data: {
            studentId: marko.student.id,
            subjectId: istorija.id,
            dayOfWeek: "WEDNESDAY",
            startTime: "08:00",
            endTime: "08:45",
            room: "203",
            isAWeek: true,
            isBWeek: true,
          },
        }),
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: matematika.id,
          dayOfWeek: "WEDNESDAY",
          startTime: "09:00",
          endTime: "09:45",
          room: "101",
          isAWeek: true,
          isBWeek: true,
        },
      }),

      // ƒåetvrtak
      fizicko &&
        prisma.scheduleEntry.create({
          data: {
            studentId: marko.student.id,
            subjectId: fizicko.id,
            dayOfWeek: "THURSDAY",
            startTime: "08:00",
            endTime: "08:45",
            room: "Sala",
            isAWeek: true,
            isBWeek: true,
          },
        }),
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: srpski.id,
          dayOfWeek: "THURSDAY",
          startTime: "09:00",
          endTime: "09:45",
          room: "205",
          isAWeek: true,
          isBWeek: true,
        },
      }),

      // Petak
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: engleski.id,
          dayOfWeek: "FRIDAY",
          startTime: "08:00",
          endTime: "08:45",
          room: "302",
          isAWeek: true,
          isBWeek: true,
        },
      }),
      prisma.scheduleEntry.create({
        data: {
          studentId: marko.student.id,
          subjectId: matematika.id,
          dayOfWeek: "FRIDAY",
          startTime: "09:00",
          endTime: "09:45",
          room: "101",
          isAWeek: true,
          isBWeek: true,
        },
      }),
    ]);

    console.log("‚úÖ Raspored kreiran\n");
  }

  console.log("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
  console.log("‚ïë                                                           ‚ïë");
  console.log("‚ïë           üéâ SEED ZAVR≈†EN - 5 DEMO NALOGA! üéâ            ‚ïë");
  console.log("‚ïë                                                           ‚ïë");
  console.log("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
  console.log("");
  console.log("üìß Demo nalozi:");
  console.log("");
  console.log("1Ô∏è‚É£  Marko Markoviƒá");
  console.log("   Email: marko@demo.rs | Lozinka: marko123");
  console.log("   5/A - O≈† Vuk Karad≈æiƒá");
  console.log("");
  console.log("2Ô∏è‚É£  Ana Petroviƒá");
  console.log("   Email: ana@demo.rs | Lozinka: ana123");
  console.log("   6/B - O≈† Dositej Obradoviƒá");
  console.log("");
  console.log("3Ô∏è‚É£  Stefan Nikoliƒá");
  console.log("   Email: stefan@demo.rs | Lozinka: stefan123");
  console.log("   7/C - O≈† Jovan Jovanoviƒá Zmaj");
  console.log("");
  console.log("4Ô∏è‚É£  Milica Stankoviƒá");
  console.log("   Email: milica@demo.rs | Lozinka: milica123");
  console.log("   4/A - O≈† Petar Petroviƒá Njego≈°");
  console.log("");
  console.log("5Ô∏è‚É£  Luka Pavloviƒá");
  console.log("   Email: luka@demo.rs | Lozinka: luka123");
  console.log("   8/D - O≈† Branko Radiƒçeviƒá");
  console.log("");
  console.log("üéØ Marko ima 3 domaƒáa zadatka i kompletan raspored!");
  console.log("üåê Login: http://localhost:3000/prijava");
  console.log("");
}

main()
  .catch((e) => {
    console.error("‚ùå Gre≈°ka:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });

